â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  CHANGELOG - Multi-Server Monitor v4                     â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

VERSION 4.0 - Major Update (2025-01-06)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ” AUTHENTICATION & SECURITY
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âœ… Full authentication system with session tokens
âœ… Login/logout endpoints (POST /api/auth/login, /api/auth/logout)
âœ… Session verification (GET /api/auth/verify)
âœ… Admin users table with password hashing (SHA256)
âœ… Session expiration (7 days, auto-cleanup on startup)
âœ… Public read-only endpoints (servers list, stats overview)
âœ… Protected admin endpoints (require authentication token)
âœ… SSH password encryption in database (XOR + Base64)
âœ… Support for both SSH key AND password authentication

ğŸ“Š DATABASE ENHANCEMENTS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âœ… Added 'timezone' column to servers table (default: UTC)
âœ… Added 'connection_timeout' column (default: 10 seconds)
âœ… Added 'ssh_password' column (encrypted storage)
âœ… New 'admin_users' table for authentication
âœ… New 'sessions' table for token management
âœ… New 'command_snippets' table for reusable commands
âœ… Session cleanup function (cleanup_expired_sessions)
âœ… Full CRUD operations for command snippets

ğŸ’» COMMAND SNIPPETS SYSTEM
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âœ… Create/Read/Update/Delete command snippets
âœ… Organize by category (general, docker, system, etc.)
âœ… Mark sudo requirement flag
âœ… Track creator (user_id)
âœ… API endpoints:
   - GET /api/snippets - List all snippets
   - POST /api/snippets - Create new snippet
   - GET /api/snippets/<id> - Get snippet details
   - PUT /api/snippets/<id> - Update snippet
   - DELETE /api/snippets/<id> - Delete snippet

ğŸ–¥ï¸  WEB TERMINAL
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âœ… WebSocket-based SSH terminal (terminal.py)
âœ… Real-time bidirectional communication
âœ… Terminal resize support
âœ… Session management per user+server
âœ… Authentication required (token-based)
âœ… Runs on separate port (9084)
âœ… Protocol:
   - Connect: ws://server:9084
   - Init: {"token": "...", "server_id": 123}
   - Input: {"type": "input", "data": "command\n"}
   - Output: {"type": "output", "data": "..."}
   - Resize: {"type": "resize", "cols": 120, "rows": 30}

âš¡ PERFORMANCE OPTIMIZATIONS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âœ… Connection timeout optimization
âœ… ThreadPoolExecutor for async operations
âœ… Quick connection test (5s timeout)
âœ… Normal operations (10s timeout)
âœ… Function: get_remote_agent_data_with_timeout()
âœ… Configurable timeout per server
âœ… Non-blocking timeout handling with futures

ğŸ”§ API IMPROVEMENTS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âœ… Updated central_api.py to v4
âœ… Authentication middleware for all POST/PUT/DELETE
âœ… Helper function: get_server_with_auth() - auto-decrypts passwords
âœ… Helper function: verify_auth_token() - validates session
âœ… All SSH operations now support password parameter
âœ… SSH password support in:
   - test_connection()
   - deploy_agent()
   - start_remote_agent()
   - execute_remote_action()
   - get_remote_agent_data()

ğŸ¨ FRONTEND
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âœ… Login page (login.html)
âœ… Beautiful gradient design
âœ… Mobile-responsive
âœ… localStorage token management
âœ… Auto-redirect if already logged in
âœ… Error handling with user feedback
âœ… Success/error alerts

ğŸ“ NEW API ENDPOINTS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Authentication:
  POST   /api/auth/login          - Login with username/password
  POST   /api/auth/logout         - Logout (invalidate token)
  GET    /api/auth/verify         - Verify current session

Command Snippets:
  GET    /api/snippets            - List all snippets (filter by category)
  POST   /api/snippets            - Create new snippet (auth required)
  GET    /api/snippets/<id>       - Get snippet by ID
  PUT    /api/snippets/<id>       - Update snippet (auth required)
  DELETE /api/snippets/<id>       - Delete snippet (auth required)

Existing endpoints now protected:
  POST   /api/servers             - Add server (auth required)
  PUT    /api/servers/<id>        - Update server (auth required)
  DELETE /api/servers/<id>        - Delete server (auth required)
  POST   /api/servers/test        - Test connection (auth required)
  POST   /api/remote/agent/*      - Agent operations (auth required)
  POST   /api/remote/action/*     - Remote actions (auth required)

Public endpoints (no auth):
  GET    /api/servers             - List servers (sensitive data hidden)
  GET    /api/stats/overview      - Get overview statistics

ğŸ”„ BREAKING CHANGES
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âš ï¸  Authentication now required for most operations
âš ï¸  Client must include 'Authorization: Bearer <token>' header
âš ï¸  Database schema changed (auto-migrated on first run)
âš ï¸  Default admin user created on first init
âš ï¸  Sessions expire after 7 days

ğŸ“¦ DEPENDENCIES
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
NEW:
  - websockets  (for web terminal)

EXISTING:
  - paramiko    (SSH connections)

Install:
  $ pip3 install paramiko websockets

ğŸš€ HOW TO UPGRADE FROM V3
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

1. Stop running services:
   $ pkill -f central_api.py

2. Install new dependencies:
   $ pip3 install websockets

3. Initialize database (adds new tables):
   $ cd /opt/server-monitor-dev/backend
   $ python3 database.py

4. Start central server:
   $ cd /opt/server-monitor-dev
   $ ./start-central.sh

5. (Optional) Start terminal server:
   $ cd /opt/server-monitor-dev/backend
   $ python3 terminal.py

6. Login with default credentials:
   Username: admin
   Password: admin123
   
   âš ï¸  CHANGE PASSWORD IMMEDIATELY!

ğŸ“– USAGE EXAMPLES
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

1. Login:
   $ curl -X POST http://localhost:9083/api/auth/login \
     -H "Content-Type: application/json" \
     -d '{"username":"admin","password":"admin123"}'
   
   Response:
   {
     "success": true,
     "token": "abc123...",
     "username": "admin",
     "expires_at": "2025-01-13T23:59:59"
   }

2. Add server with password:
   $ curl -X POST http://localhost:9083/api/servers \
     -H "Authorization: Bearer abc123..." \
     -H "Content-Type: application/json" \
     -d '{
       "name": "My Server",
       "host": "192.168.1.100",
       "username": "root",
       "ssh_password": "mypassword",
       "port": 22,
       "agent_port": 8083
     }'

3. Create command snippet:
   $ curl -X POST http://localhost:9083/api/snippets \
     -H "Authorization: Bearer abc123..." \
     -H "Content-Type: application/json" \
     -d '{
       "name": "System Update",
       "command": "apt-get update && apt-get upgrade -y",
       "description": "Update system packages",
       "category": "system",
       "is_sudo": 1
     }'

4. Connect to web terminal:
   const ws = new WebSocket('ws://localhost:9084');
   
   ws.onopen = () => {
     ws.send(JSON.stringify({
       token: 'abc123...',
       server_id: 1
     }));
   };
   
   ws.onmessage = (event) => {
     const data = JSON.parse(event.data);
     if (data.type === 'output') {
       console.log(data.data);
     }
   };
   
   // Send command
   ws.send(JSON.stringify({
     type: 'input',
     data: 'ls -la\n'
   }));

ğŸ› BUG FIXES
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âœ… Fixed SSH password not being passed to remote operations
âœ… Fixed session cleanup not running
âœ… Fixed connection pool not handling password auth
âœ… Fixed server list exposing sensitive data to public

ğŸ”® FUTURE ENHANCEMENTS (Not Yet Implemented)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â³ Full dashboard HTML interface
â³ Real-time charts and graphs
â³ Alert notifications (email/webhook)
â³ Multi-user role management (viewer/operator/admin)
â³ Server groups and bulk operations
â³ Scheduled tasks and cron jobs
â³ File browser and transfer
â³ Log viewer and search
â³ Two-factor authentication (2FA)
â³ LDAP/Active Directory integration

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

For questions or issues, check the documentation:
  - INSTALL.txt           - Installation guide
  - MULTI-SERVER-GUIDE.md - Complete user guide
  - README-MULTI-SERVER.md - Quick start

Version: 4.0
Date: 2025-01-06
